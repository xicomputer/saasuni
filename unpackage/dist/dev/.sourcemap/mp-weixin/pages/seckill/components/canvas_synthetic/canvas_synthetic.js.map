{"version":3,"sources":["webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?7c75","webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?3028","webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?9d7f","webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?438d","uni-app:///pages/seckill/components/canvas_synthetic/canvas_synthetic.vue","webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?59e1","webpack:///D:/products/xssj_New_basic_uni/pages/seckill/components/canvas_synthetic/canvas_synthetic.vue?07c7"],"names":[],"mappings":"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","file":"pages/seckill/components/canvas_synthetic/canvas_synthetic.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./canvas_synthetic.vue?vue&type=template&id=285e95e2&\"\nvar renderjs\nimport script from \"./canvas_synthetic.vue?vue&type=script&lang=js&\"\nexport * from \"./canvas_synthetic.vue?vue&type=script&lang=js&\"\nimport style0 from \"./canvas_synthetic.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/seckill/components/canvas_synthetic/canvas_synthetic.vue\"\nexport default component.exports","export * from \"-!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./canvas_synthetic.vue?vue&type=template&id=285e95e2&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./canvas_synthetic.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./canvas_synthetic.vue?vue&type=script&lang=js&\"","<template>\n    <!-- components/canvas_synthetic/canvas_synthetic.wxml -->\n    <view class=\"canvas-style\" :style=\"'top:' + -canvasHeight + 'px'\">\n        <canvas\n            :canvas-id=\"canvasId\"\n            :height=\"canvasHeight * 4 + 'px'\"\n            :width=\"canvasWidth * 4 + 'px'\"\n            :style=\"'width:' + canvasWidth + 'px;height:' + canvasHeight + 'px;'\"\n        ></canvas>\n    </view>\n</template>\n\n<script>\n// components/canvas_synthetic/canvas_synthetic.js\nexport default {\n    data() {\n        return {\n            tempImgUrl: '' //存储生成后的图片\n        };\n    },\n    /**\n     * 组件的属性列表\n     */\n    props: {\n        canvasId: {\n            type: String,\n            default: ''\n        },\n        canvasWidth: {\n            type: Number,\n            default: 0\n        },\n        canvasHeight: {\n            type: Number,\n            default: 0\n        },\n        canvasBgcolor: {\n            type: String,\n            default: '#fff'\n        },\n        showline: {\n            type: Boolean,\n            default: true\n        },\n        imgs: {\n            type: Array,\n            default: () => [] //{src:'',width:0,height:0,x:0,y:0}\n        },\n        imgUrl: {\n            type: String,\n            default: ''\n        },\n        texts: {\n            type: Array,\n            default: () => [] //{content:'测试',color:'#999',size:20,x:10,y:10}\n        },\n        rectInfo: {\n            type: [Array, Object],\n            default: null\n        }\n    },\n    created: function () {},\n    beforeMount: function () {\n        // 在组件实例进入页面节点树时执行\n    },\n    destroyed: function () {\n        // 在组件实例被从页面节点树移除时执行\n    },\n    /**\n     * 组件的方法列表\n     */\n    methods: {\n        darwRoundRect(x, y, w, h, r, bgcolor, ctx) {\n            //绘制椭圆\n            ctx.save();\n            ctx.beginPath(); // 左上弧线\n\n            ctx.arc(x + r, y + r, r, 1 * Math.PI, 1.5 * Math.PI); // 左直线\n\n            ctx.moveTo(x, y + r);\n            ctx.lineTo(x, y + h - r); // 左下弧线\n\n            ctx.arc(x + r, y + h - r, r, 0.5 * Math.PI, 1 * Math.PI); // 下直线\n\n            ctx.lineTo(x + r, y + h);\n            ctx.lineTo(x + w - r, y + h); // 右下弧线\n\n            ctx.arc(x + w - r, y + h - r, r, 0 * Math.PI, 0.5 * Math.PI); // 右直线\n\n            ctx.lineTo(x + w, y + h - r);\n            ctx.lineTo(x + w, y + r); // 右上弧线\n\n            ctx.arc(x + w - r, y + r, r, 1.5 * Math.PI, 2 * Math.PI); // 上直线\n\n            ctx.lineTo(x + w - r, y);\n            ctx.lineTo(x + r, y);\n            ctx.setFillStyle(bgcolor);\n            ctx.fill();\n        },\n\n        //获取背景图片信息\n        async startSyntheticImg() {\n            let arr = [];\n\n            for (let item of this.imgs) {\n                let imgItem = { ...item };\n\n                if (item.src.search(/https:\\/\\/|http:\\/\\/'/) !== -1) {\n                    let result = await uni.getImageInfo({\n                        src: item.src\n                    });\n                    imgItem.src = result.path;\n                }\n\n                arr.push(imgItem);\n            }\n\n            this.syntheticImg(arr);\n        },\n\n        //绘制合成图片\n        syntheticImg(imgs) {\n            uni.showLoading({\n                title: '海报生成中'\n            });\n            var { canvasId, texts, canvasWidth, canvasHeight, canvasBgcolor, showline } = this;\n            const ctx = uni.createCanvasContext(canvasId, this); //绘制白色背景\n\n            ctx.setFillStyle(canvasBgcolor);\n            ctx.fillRect(0, 0, canvasWidth, canvasHeight); //绘制背景图\n\n            imgs.forEach((item) => {\n                ctx.drawImage(item.src, item.x, item.y, item.width, item.height);\n            }); //绘制圆角矩形\n\n            var rectInfo = this.rectInfo;\n\n            if (rectInfo) {\n                this.darwRoundRect(...rectInfo, ctx);\n            } //绘制文本\n\n            ctx.setTextAlign('left');\n            ctx.setTextBaseline('top');\n            texts.forEach((item) => {\n                ctx.setFillStyle(item.color); // 文字颜色：黑色\n\n                ctx.setFontSize(item.size); // 文字字号：22px\n                //开始绘制文本的 x/y 坐标位置（相对于画布）\n\n                const textStrWidth = ctx.measureText(item.content).width;\n                const textHeight = ctx.measureText(item.content).height;\n\n                if (item.textWidth) {\n                    this.textNewline(ctx, item);\n                } else {\n                    if (item.center) {\n                        ctx.textAlign = 'center';\n                    } else {\n                        ctx.textAlign = 'left';\n                    }\n\n                    ctx.fillText(item.content, item.x, item.y, item.textWidth);\n                }\n\n                if (item.isDelLine) {\n                    ctx.beginPath();\n                    ctx.rect(item.x - textStrWidth / 2, item.y + 10, textStrWidth, 2);\n                    ctx.fillStyle = '#fff';\n                    ctx.fill();\n                }\n\n                ctx.draw(true);\n            });\n\n            if (showline) {\n                //绘制虚线\n                ctx.setLineDash([6, 8], 3);\n                ctx.beginPath();\n                ctx.moveTo(0, 395);\n                ctx.lineTo(400, 395);\n            }\n\n            ctx.stroke(); //stroke() 方法会实际地绘制出通过 moveTo() 和 lineTo() 方法定义的路径\n\n            ctx.draw(true);\n            this.generateImg();\n        },\n\n        //生成图片\n        generateImg() {\n            var that = this;\n            setTimeout(function () {\n                var { canvasId, canvasWidth, canvasHeight } = that;\n                var { cWidth, cHeight } = that; //把当前画布指定区域的内容导出生成指定大小的图片，并返回文件路径\n\n                uni.canvasToTempFilePath(\n                    {\n                        x: 0,\n                        y: 0,\n                        width: canvasWidth,\n                        height: canvasHeight,\n                        //输出的图片的尺寸（写成width的两倍，生成的图片则更清晰）\n                        destWidth: canvasWidth * 2,\n                        destHeight: canvasHeight * 2,\n                        canvasId: canvasId,\n                        success: function (res) {\n                            uni.hideLoading();\n                            var tempImgUrl = res.tempFilePath;\n                            that.setData({\n                                tempImgUrl\n                            });\n                            that.$emit('generateComplete', {\n                                detail: {\n                                    url: tempImgUrl,\n                                    width: cWidth,\n                                    height: cHeight\n                                }\n                            });\n                        },\n                        fail: (err) => {\n                            console.log(err);\n                        }\n                    },\n                    that\n                );\n            }, 1000);\n        },\n\n        //保存图片\n        saveImg() {\n            uni.saveImageToPhotosAlbum({\n                filePath: this.tempImgUrl,\n                success: (res) => {\n                    uni.showToast({\n                        title: '已保存到相册',\n                        icon: 'none'\n                    });\n                    console.log('保存成功！', res);\n                }\n            });\n        },\n\n        //文本换行处理\n        textNewline(ctx, textItem) {\n            var text = textItem.content;\n            var chr = text.split(''); //这个方法是将一个字符串分割成字符串数组\n\n            var temp = '';\n            var row = [];\n            ctx.setFontSize(textItem.size);\n            ctx.setFillStyle(textItem.color);\n\n            for (var a = 0; a < chr.length; a++) {\n                if (ctx.measureText(temp).width < textItem.textWidth) {\n                    temp += chr[a];\n                } else {\n                    a--; //这里添加了a-- 是为了防止字符丢失，效果图中有对比\n\n                    row.push(temp);\n                    temp = '';\n                }\n            }\n\n            row.push(temp); //如果数组长度大于2 则截取前两个\n\n            if (row.length > 2) {\n                var rowCut = row.slice(0, 2);\n                var rowPart = rowCut[1];\n                var test = '';\n                var empty = [];\n\n                for (var a = 0; a < rowPart.length; a++) {\n                    if (ctx.measureText(test).width < 220) {\n                        test += rowPart[a];\n                    } else {\n                        break;\n                    }\n                }\n\n                empty.push(test);\n                var group = empty[0] + '...'; //这里只显示两行，超出的用...表示\n\n                rowCut.splice(1, 1, group);\n                row = rowCut;\n            }\n\n            for (var b = 0; b < row.length; b++) {\n                ctx.fillText(row[b], 10, textItem.y + b * 20, textItem.textWidth);\n            }\n\n            ctx.draw();\n        }\n    }\n};\n</script>\n<style>\n/* components/canvas_synthetic/canvas_synthetic.wxss */\n.canvas-style {\n    position: absolute;\n    visibility: hidden;\n    opacity: 0;\n}\n</style>\n","import mod from \"-!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./canvas_synthetic.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./canvas_synthetic.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1659404723448\n      var cssReload = require(\"D:/hbuild/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}