{"version":3,"file":"store.js","sources":["../src/common.js","../src/diff.js","../src/polyfill.js","../src/index.js"],"sourcesContent":["export const TYPE_ARRAY = \"[object Array]\";\r\nexport const TYPE_OBJECT = \"[object Object]\";\r\nexport const _typeOf = function(val) {\r\n  return Object.prototype.toString.call(val);\r\n};\r\nexport const _deepClone = function(obj) {\r\n  return JSON.parse(JSON.stringify(obj));\r\n};\r\n","import { _typeOf, TYPE_ARRAY, TYPE_OBJECT } from \"./common\";\r\n/**\r\n * diff库\r\n * @author Leisure\r\n * @update 2019.11.27\r\n * @param {object} current - 当前状态\r\n * @param {object} prev - 之前状态\r\n */\r\nconst diff = function diff(current = {}, prev = {}) {\r\n  let result = {};\r\n  updateDiff(current, prev, \"\", result);\r\n  nullDiff(current, prev, \"\", result);\r\n  return result;\r\n};\r\n\r\nconst updateDiff = function updateDiff(\r\n  current = {},\r\n  prev = {},\r\n  root = \"\",\r\n  result = {}\r\n) {\r\n  if(_typeOf(current) === TYPE_ARRAY && ((_typeOf(prev) === TYPE_ARRAY && current.length !== prev.length) || _typeOf(prev) !== TYPE_ARRAY)){\r\n    result[root] = current\r\n    return;\r\n  }\r\n  Object.entries(current).forEach(item => {\r\n    let key = item[0],\r\n      value = item[1],\r\n      path = root === \"\" ? key : root + \".\" + key;\r\n    if (_typeOf(current) === TYPE_ARRAY) {\r\n      path = root === \"\" ? key : root + \"[\" + key + \"]\";\r\n    }\r\n    if (!prev.hasOwnProperty(key)) {\r\n      result[path] = value;\r\n    } else if (\r\n      (_typeOf(prev[key]) === TYPE_OBJECT &&\r\n        _typeOf(current[key]) === TYPE_OBJECT) ||\r\n      (_typeOf(prev[key]) === TYPE_ARRAY &&\r\n        _typeOf(current[key]) === TYPE_ARRAY)\r\n    ) {\r\n      updateDiff(current[key], prev[key], path, result);\r\n    } else if (prev[key] !== current[key]) {\r\n      result[path] = value;\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nconst nullDiff = function nullDiff(\r\n  current = {},\r\n  prev = {},\r\n  root = \"\",\r\n  result = {}\r\n) {\r\n  if(_typeOf(current) === TYPE_ARRAY && ((_typeOf(prev) === TYPE_ARRAY && current.length !== prev.length) || _typeOf(prev) !== TYPE_ARRAY)){\r\n    return;\r\n  }\r\n  Object.entries(prev).forEach(item => {\r\n    let key = item[0],\r\n      path = root === \"\" ? key : root + \".\" + key;\r\n    if (_typeOf(current) === TYPE_ARRAY) {\r\n      path = root === \"\" ? key : root + \"[\" + key + \"]\";\r\n    }\r\n\r\n    if (!current.hasOwnProperty(key)) {\r\n      result[path] = null;\r\n    } else if (\r\n      (_typeOf(prev[key]) === TYPE_OBJECT &&\r\n        _typeOf(current[key]) === TYPE_OBJECT) ||\r\n      (_typeOf(prev[key]) === TYPE_ARRAY &&\r\n        _typeOf(current[key]) === TYPE_ARRAY)\r\n    ) {\r\n      nullDiff(current[key], prev[key], path, result);\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nexport default diff;\r\n","if (!Object.keys) {\r\n  Object.keys = (function () {\r\n    var hasOwnProperty = Object.prototype.hasOwnProperty,\r\n      hasDontEnumBug = !{ toString: null }.propertyIsEnumerable(\"toString\"),\r\n      dontEnums = [\r\n        \"toString\",\r\n        \"toLocaleString\",\r\n        \"valueOf\",\r\n        \"hasOwnProperty\",\r\n        \"isPrototypeOf\",\r\n        \"propertyIsEnumerable\",\r\n        \"constructor\",\r\n      ],\r\n      dontEnumsLength = dontEnums.length;\r\n\r\n    return function (obj) {\r\n      if (\r\n        (typeof obj !== \"object\" && typeof obj !== \"function\") ||\r\n        obj === null\r\n      )\r\n        throw new TypeError(\"Object.keys called on non-object\");\r\n\r\n      var result = [];\r\n\r\n      for (var prop in obj) {\r\n        if (hasOwnProperty.call(obj, prop)) result.push(prop);\r\n      }\r\n\r\n      if (hasDontEnumBug) {\r\n        for (var i = 0; i < dontEnumsLength; i++) {\r\n          if (hasOwnProperty.call(obj, dontEnums[i])) result.push(dontEnums[i]);\r\n        }\r\n      }\r\n      return result;\r\n    };\r\n  })();\r\n}\r\nif (!Object.entries)\r\n  Object.entries = function (obj) {\r\n    var ownProps = Object.keys(obj),\r\n      i = ownProps.length,\r\n      resArray = new Array(i); // preallocate the Array\r\n    while (i--) resArray[i] = [ownProps[i], obj[ownProps[i]]];\r\n\r\n    return resArray;\r\n  };\r\n","import { _typeOf, _deepClone, TYPE_ARRAY, TYPE_OBJECT } from \"./common\";\r\nimport diff from \"./diff\";\r\nimport pkg from \"../package.json\";\r\nimport \"./polyfill\";\r\n\r\nconst Version = pkg.version;\r\nconsole.log(\"当前wxministore版本：\" + Version);\r\n/**\r\n * Store\r\n * @author Leisure\r\n * @update 2020.7.28\r\n * @version 1.3.0\r\n */\r\nclass Store {\r\n  version = Version;\r\n  $state = {};\r\n  $r = [];\r\n  constructor(option) {\r\n    //必要参数的默认值处理\r\n    let {\r\n      openPart = false,\r\n      behavior,\r\n      methods = {},\r\n      pageLisener = {},\r\n      pageListener,\r\n      nonWritable = false,\r\n      debug = true,\r\n    } = option;\r\n    pageListener = pageListener || pageLisener;\r\n    this.debug = debug;\r\n    //状态初始化\r\n    this.$state = {};\r\n    if (_typeOf(option.state) === TYPE_OBJECT) {\r\n      this.$state = _deepClone(option.state);\r\n    }\r\n    //页面+组件树\r\n    this.$r = [];\r\n    //创建时，添加组件\r\n    const _create = function (r, o = {}) {\r\n      r.$store = {};\r\n      const { useProp } = o;\r\n      if (o.hasOwnProperty(\"useProp\")) {\r\n        if (\r\n          (useProp && typeof useProp === \"string\") ||\r\n          _typeOf(useProp) === TYPE_ARRAY\r\n        ) {\r\n          r.$store.useProp = [].concat(useProp);\r\n        } else {\r\n          r.$store.useProp = [];\r\n        }\r\n      }\r\n\r\n      r.$store.useStore = canUseStore(o);\r\n      if (canUseStore(o)) {\r\n        _store.$r.push(r);\r\n        if (r.$store.useProp) {\r\n          r.setData({\r\n            $state: _filterKey(\r\n              _store.$state,\r\n              r.$store.useProp,\r\n              (key, usekey) => key === usekey\r\n            ),\r\n          });\r\n        } else {\r\n          r.setData({\r\n            $state: _store.$state,\r\n          });\r\n        }\r\n      }\r\n    };\r\n    //销毁时，移除组件\r\n    const _destroy = function (r) {\r\n      let index = _store.$r.findIndex((item) => item === r);\r\n      if (index > -1) {\r\n        _store.$r.splice(index, 1);\r\n      }\r\n    };\r\n    //状态局部模式\r\n    this.$openPart = openPart;\r\n    //其他参数\r\n    const _store = this;\r\n    const pageLife = [\r\n      \"data\",\r\n      \"onLoad\",\r\n      \"onShow\",\r\n      \"onReady\",\r\n      \"onHide\",\r\n      \"onUnload\",\r\n      \"onPullDownRefresh\",\r\n      \"onReachBottom\",\r\n      \"onShareAppMessage\",\r\n      \"onPageScroll\",\r\n      \"onTabItemTap\",\r\n    ];\r\n    const canUseStore = function (o = {}) {\r\n      return (openPart === true && o.useStore === true) || !openPart;\r\n    };\r\n\r\n    const originPage = Page,\r\n      originComponent = Component;\r\n\r\n    //重写Page\r\n    App.Page = function (o = {}, ...args) {\r\n      if (canUseStore(o)) {\r\n        //状态注入\r\n        o.data = {\r\n          ...(o.data || {}),\r\n          $state: _store.$state,\r\n        };\r\n      }\r\n      //行为注入\r\n      Object.keys(methods).forEach((key) => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof methods[key] === \"function\" &&\r\n          !pageLife.some((item) => item === key)\r\n        ) {\r\n          o[key] = methods[key];\r\n        }\r\n      });\r\n      //覆盖原周期\r\n      const originCreate = o.onLoad;\r\n      o.onLoad = function () {\r\n        _create(this, o);\r\n        originCreate && originCreate.apply(this, arguments);\r\n      };\r\n      const originonDestroy = o.onUnload;\r\n      o.onUnload = function () {\r\n        _destroy(this);\r\n        originonDestroy && originonDestroy.apply(this, arguments);\r\n      };\r\n      //其他页面周期事件注入 pageListener\r\n      Object.keys(pageListener).forEach((key) => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof pageListener[key] === \"function\" &&\r\n          pageLife.some((item) => item === key)\r\n        ) {\r\n          const originLife = o[key];\r\n          o[key] = function () {\r\n            pageListener[key].apply(this, arguments);\r\n            originLife && originLife.apply(this, arguments);\r\n          };\r\n        }\r\n      });\r\n      originPage(o, ...args);\r\n    };\r\n\r\n    if (!nonWritable) {\r\n      try {\r\n        Page = App.Page;\r\n      } catch (e) {}\r\n    }\r\n\r\n    //重写组件\r\n    App.Component = function (o = {}, ...args) {\r\n      //状态注入\r\n      if (canUseStore(o)) {\r\n        o.data = {\r\n          ...(o.data || {}),\r\n          $state: _store.$state,\r\n        };\r\n      }\r\n      //行为注入\r\n      Object.keys(methods).forEach((key) => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof methods[key] === \"function\" &&\r\n          !pageLife.some((item) => item === key)\r\n        ) {\r\n          o.methods || (o.methods = {});\r\n          o.methods[key] = methods[key];\r\n        }\r\n      });\r\n      //behavior\r\n      if (behavior) {\r\n        o.behaviors = [behavior, ...(o.behaviors || [])];\r\n      }\r\n      const { lifetimes = {} } = o;\r\n\r\n      let originCreate = lifetimes.attached || o.attached,\r\n        originonDestroy = lifetimes.detached || o.detached;\r\n      const attached = function () {\r\n        _create(this, o);\r\n        originCreate && originCreate.apply(this, arguments);\r\n      };\r\n\r\n      const detached = function () {\r\n        _destroy(this);\r\n        originonDestroy && originonDestroy.apply(this, arguments);\r\n      };\r\n      if (_typeOf(o.lifetimes) === TYPE_OBJECT) {\r\n        o.lifetimes.attached = attached;\r\n        o.lifetimes.detached = detached;\r\n      } else {\r\n        o.attached = attached;\r\n        o.detached = detached;\r\n      }\r\n\r\n      //覆盖原周期\r\n\r\n      originComponent(o, ...args);\r\n    };\r\n    if (!nonWritable) {\r\n      try {\r\n        Component = App.Component;\r\n      } catch (e) {}\r\n    }\r\n  }\r\n\r\n  setState(obj, fn = () => {}) {\r\n    if (_typeOf(obj) !== TYPE_OBJECT) {\r\n      throw new Error(\"setState的第一个参数须为object!\");\r\n    }\r\n    this.debug && console.time && console.time(\"setState\");\r\n    let prev = this.$state;\r\n    let current = setData(obj, prev);\r\n    this.$state = current;\r\n    //如果有组件\r\n    if (this.$r.length > 0) {\r\n      let diffObj = diff(current, prev);\r\n      this.debug && console.log(\"diff后实际设置的值：\", _deepClone(diffObj));\r\n      let keys = Object.keys(diffObj);\r\n      if (keys.length > 0) {\r\n        const newObj = {};\r\n        keys.forEach((key) => {\r\n          newObj[\"$state.\" + key] = diffObj[key];\r\n        });\r\n        let pros = this.$r.map((r) => {\r\n          if (r.$store.hasOwnProperty(\"useProp\")) {\r\n            let useprops = _filterKey(\r\n              newObj,\r\n              r.$store.useProp,\r\n              (key, useKey) =>\r\n                key === \"$state.\" + useKey ||\r\n                !!key.match(new RegExp(\"^[$]state.\" + useKey + \"[.|[]\", \"g\"))\r\n            );\r\n            if (Object.keys(useprops).length > 0) {\r\n              return new Promise((resolve) => {\r\n                r.setData(useprops, resolve);\r\n              });\r\n            } else {\r\n              return Promise.resolve();\r\n            }\r\n          }\r\n          return new Promise((resolve) => {\r\n            r.setData(newObj, resolve);\r\n          });\r\n        });\r\n        Promise.all(pros).then(fn);\r\n      } else {\r\n        fn();\r\n      }\r\n    } else {\r\n      fn();\r\n    }\r\n    this.debug && console.timeEnd && console.timeEnd(\"setState\");\r\n  }\r\n  getState() {\r\n    return _deepClone(this.$state);\r\n  }\r\n  clearState(fn = () => {}) {\r\n    this.debug && console.time && console.time(\"clearState\");\r\n    let current = {};\r\n    this.$state = current;\r\n    //如果有组件\r\n    if (this.$r.length > 0) {\r\n      let pros = this.$r.map((r) => {\r\n        let newObj = {\r\n          $state: {},\r\n        };\r\n        return new Promise((resolve) => {\r\n          r.setData(newObj, resolve);\r\n        });\r\n      });\r\n      Promise.all(pros).then(fn);\r\n    } else {\r\n      fn();\r\n    }\r\n    this.debug && console.timeEnd && console.timeEnd(\"clearState\");\r\n  }\r\n}\r\n\r\nconst _filterKey = function (obj, useKeys = [], fn) {\r\n  let result = {};\r\n  Object.keys(obj)\r\n    .filter((key) =>\r\n      useKeys.some((usekey) => {\r\n        return fn(key, usekey);\r\n      })\r\n    )\r\n    .forEach((key) => {\r\n      result[key] = obj[key];\r\n    });\r\n  return result;\r\n};\r\n\r\nconst setData = function (obj, data) {\r\n  let result = _deepClone(data);\r\n  let origin = _deepClone(obj);\r\n  Object.keys(origin).forEach((key) => {\r\n    dataHandler(key, origin[key], result);\r\n  });\r\n  return result;\r\n};\r\n\r\nconst dataHandler = function (key, result, data) {\r\n  let arr = pathHandler(key);\r\n  let d = data;\r\n  for (let i = 0; i < arr.length - 1; i++) {\r\n    keyToData(arr[i], arr[i + 1], d);\r\n    d = d[arr[i]];\r\n  }\r\n  d[arr[arr.length - 1]] = result;\r\n};\r\n\r\nconst pathHandler = function (key) {\r\n  let current = \"\",\r\n    keyArr = [];\r\n  for (let i = 0, len = key.length; i < len; i++) {\r\n    if (key[0] === \"[\") {\r\n      throw new Error(\"key值不能以[]开头\");\r\n    }\r\n    if (key[i].match(/\\.|\\[/g)) {\r\n      cleanAndPush(current, keyArr);\r\n      current = \"\";\r\n    }\r\n    current += key[i];\r\n  }\r\n  cleanAndPush(current, keyArr);\r\n  return keyArr;\r\n};\r\n\r\nconst cleanAndPush = function (key, arr) {\r\n  let r = cleanKey(key);\r\n  if (r !== \"\") {\r\n    arr.push(r);\r\n  }\r\n};\r\n\r\nconst keyToData = function (prev, current, data) {\r\n  if (prev === \"\") {\r\n    return;\r\n  }\r\n  const type = _typeOf(data[prev]);\r\n  if (typeof current === \"number\" && type !== TYPE_ARRAY) {\r\n    data[prev] = [];\r\n  } else if (typeof current === \"string\" && type !== TYPE_OBJECT) {\r\n    data[prev] = {};\r\n  }\r\n};\r\n\r\nconst cleanKey = function (key) {\r\n  if (key.match(/\\[\\S+\\]/g)) {\r\n    let result = key.replace(/\\[|\\]/g, \"\");\r\n    if (!Number.isNaN(parseInt(result))) {\r\n      return +result;\r\n    } else {\r\n      throw new Error(`[]中必须为数字`);\r\n    }\r\n  }\r\n  return key.replace(/\\[|\\.|\\]| /g, \"\");\r\n};\r\n\r\nexport default Store;\r\n"],"names":["TYPE_ARRAY","TYPE_OBJECT","_typeOf","val","Object","prototype","toString","call","_deepClone","obj","JSON","parse","stringify","diff","current","prev","result","updateDiff","root","length","entries","forEach","key","item","value","path","hasOwnProperty","nullDiff","keys","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","TypeError","prop","push","i","ownProps","resArray","Array","Version","pkg","version","console","log","Store","option","$state","$r","openPart","behavior","methods","pageLisener","pageListener","nonWritable","debug","state","_create","r","o","$store","useProp","concat","useStore","canUseStore","setData","_filterKey","_store","usekey","_destroy","index","findIndex","splice","$openPart","this","pageLife","originPage","Page","originComponent","Component","args","data","some","originCreate","onLoad","apply","arguments","originonDestroy","onUnload","originLife","App","e","behaviors","attached","detached","lifetimes","fn","Error","time","diffObj","newObj","pros","map","useprops","useKey","match","RegExp","Promise","resolve","all","then","timeEnd","useKeys","filter","origin","dataHandler","arr","pathHandler","d","keyArr","len","cleanAndPush","cleanKey","keyToData","type","replace","Number","isNaN","parseInt"],"mappings":"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"}